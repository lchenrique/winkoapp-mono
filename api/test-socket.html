<!DOCTYPE html>
<html>
<head>
    <title>Socket.IO Test</title>
</head>
<body>
    <h1>Socket.IO Connection Test</h1>
    <div id="status">Connecting...</div>
    <div id="messages"></div>
    <input type="text" id="messageInput" placeholder="Digite uma mensagem...">
    <button onclick="sendTest()">Enviar Teste</button>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const statusEl = document.getElementById('status');
        const messagesEl = document.getElementById('messages');
        
        // Test without authentication first
        const socket = io('http://localhost:3000');
        
        socket.on('connect', () => {
            statusEl.textContent = '✅ Connected to Socket.IO';
            statusEl.style.color = 'green';
            console.log('Connected to Socket.IO server');
        });
        
        socket.on('disconnect', (reason) => {
            statusEl.textContent = '❌ Disconnected: ' + reason;
            statusEl.style.color = 'red';
            console.log('Disconnected:', reason);
        });
        
        socket.on('connect_error', (error) => {
            statusEl.textContent = '🔥 Connection error: ' + error.message;
            statusEl.style.color = 'red';
            console.error('Connection error:', error);
        });
        
        socket.on('message:new', (data) => {
            console.log('Message received:', data);
            const msgEl = document.createElement('div');
            msgEl.textContent = 'Received: ' + JSON.stringify(data);
            messagesEl.appendChild(msgEl);
        });
        
        function sendTest() {
            const message = document.getElementById('messageInput').value;
            socket.emit('test-message', {
                content: message,
                timestamp: new Date().toISOString()
            });
            console.log('Test message sent:', message);
            
            const msgEl = document.createElement('div');
            msgEl.textContent = 'Sent: ' + message;
            msgEl.style.color = 'blue';
            messagesEl.appendChild(msgEl);
            
            document.getElementById('messageInput').value = '';
        }
        
        // Test joining a room
        setTimeout(() => {
            socket.emit('conversation:join', { conversationId: 'test-room-123' });
            console.log('Joined test room');
        }, 2000);
    </script>
</body>
</html>
